<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-header d-flex align-items-center bg-primary text-white">
      <h5 class="m-0 d-flex align-items-center">
        <i class="bi bi-plus-circle me-2"></i> Создать расписание
      </h5>
    </div>

    <div class="card-body">
      <div *ngIf="serverError" class="alert alert-danger mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i> {{ serverError }}
      </div>

      <form #schedForm="ngForm" (ngSubmit)="submit(schedForm)" novalidate>
        <div class="mb-3">
          <label for="group" class="form-label">
            Группа <span class="text-danger">*</span>
          </label>
          <select
            id="group"
            class="form-select"
            name="group"
            required
            [(ngModel)]="form.group"
          >
            <option [ngValue]="undefined">-- Выберите группу --</option>
            <option *ngFor="let g of groups" [ngValue]="g.id">
              {{ g.name || g.code || g.id }}
            </option>
          </select>
          <div
            *ngIf="schedForm.submitted && !form.group"
            class="text-danger small"
          >
            Группа обязательна для заполнения.
          </div>
        </div>

        <div class="mb-3">
          <label for="subject" class="form-label">
            Предмет <span class="text-danger">*</span>
          </label>
          <select
            id="subject"
            class="form-select"
            name="subject"
            required
            [(ngModel)]="form.subject"
          >
            <option [ngValue]="undefined">-- Выберите предмет --</option>
            <option *ngFor="let s of subjects" [ngValue]="s.id">
              {{ s.name || s.code || s.id }}
            </option>
          </select>
          <div
            *ngIf="schedForm.submitted && !form.subject"
            class="text-danger small"
          >
            Предмет обязателен для заполнения.
          </div>
        </div>

        <div class="mb-3">
          <label for="teacher" class="form-label">
            Преподаватель <span class="text-danger">*</span>
          </label>
          <select
            id="teacher"
            class="form-select"
            name="teacher"
            required
            [(ngModel)]="form.teacher"
          >
            <option [ngValue]="undefined">-- Выберите преподавателя --</option>
            <option *ngFor="let t of teachers" [ngValue]="t.id">
              {{ (t.user?.first_name || "") + " " + (t.user?.last_name || "") }}
              <span *ngIf="!(t.user?.first_name || t.user?.last_name)">
                {{ t.user?.username || t.id }}
              </span>
            </option>
          </select>
          <div
            *ngIf="schedForm.submitted && !form.teacher"
            class="text-danger small"
          >
            Преподаватель обязателен для заполнения.
          </div>
        </div>

        <div class="mb-3">
          <label for="weekDay" class="form-label">
            День недели <span class="text-danger">*</span>
          </label>
          <select
            id="weekDay"
            class="form-select"
            name="week_day"
            required
            [(ngModel)]="form.week_day"
          >
            <option [ngValue]="undefined">-- Выберите день --</option>
            <option *ngFor="let d of weekdays" [ngValue]="d.value">
              {{ d.label }}
            </option>
          </select>
          <div
            *ngIf="schedForm.submitted && form.week_day == null"
            class="text-danger small"
          >
            День обязателен для заполнения.
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="startTime" class="form-label">
              Время начала <span class="text-danger">*</span>
            </label>
            <input
              type="time"
              id="startTime"
              class="form-control"
              name="start_time"
              required
              [(ngModel)]="form.start_time"
              (change)="validateTimes()"
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="endTime" class="form-label">
              Время окончания <span class="text-danger">*</span>
            </label>
            <input
              type="time"
              id="endTime"
              class="form-control"
              name="end_time"
              required
              [(ngModel)]="form.end_time"
              (change)="validateTimes()"
            />
          </div>
        </div>

        <div *ngIf="timeError" class="text-danger small mb-3">
          {{ timeError }}
        </div>

        <div class="d-flex gap-2">
          <button
            class="btn btn-primary"
            type="submit"
            [disabled]="schedForm.invalid || !!timeError"
          >
            <i class="bi bi-plus-circle me-1"></i> Создать
          </button>
          <a class="btn btn-outline-secondary" routerLink="/schedules">
            <i class="bi bi-x-circle me-1"></i> Отмена
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
